<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Payload Mapping - Eclipse Vorto</title>
    <meta name="generator" content="Hugo 0.37.1" />

    
    <meta name="description" content="Describe. Share. Integrate.">
    
    <link rel="canonical" href="https://www.eclipse.org/vorto/documentation/mappingengine/">
    
    <meta name="author" content="The Eclipse Vorto Project">
    

    <meta property="og:url" content="https://www.eclipse.org/vorto/documentation/mappingengine/">
    <meta property="og:title" content="Eclipse Vorto">
    <meta property="og:image" content="https://www.eclipse.org/vorto/images/vorto.png">
    <meta name="apple-mobile-web-app-title" content="Eclipse Vorto">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://www.eclipse.org/vorto/images/vorto.ico">
    <link rel="icon" type="image/x-icon" href="https://www.eclipse.org/vorto/images/vorto.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://www.eclipse.org/vorto/fonts/icon.eot');
        src: url('https://www.eclipse.org/vorto/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://www.eclipse.org/vorto/fonts/icon.woff')
               format('woff'),
             url('https://www.eclipse.org/vorto/fonts/icon.ttf')
               format('truetype'),
             url('https://www.eclipse.org/vorto/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/application.css">
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/css/vorto.css">
    
    <link rel="stylesheet" href="//www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/vendor/cookieconsent/cookieconsent.min.css">
    
    <script src="https://www.eclipse.org/vorto/javascripts/modernizr.js"></script>
    <script src="//www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Payload Mapping
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/VortoIoT" title="@VortoIoT on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/eclipse/vorto" title="@eclipse/vorto on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://www.eclipse.org/vorto/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://www.eclipse.org/vorto/images/vorto.png">
        </div>
      
      <div class="name">
        <strong>Eclipse Vorto </strong>
        
          <br>
          eclipse/vorto
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="http://vorto.eclipse.org" title="Repository" data-action="download">
              <i class="icon icon-search"></i> Repository
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/eclipse/vorto" target="_blank" title="Vorto on GitHub" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="What is Vorto" href="https://www.eclipse.org/vorto/introduction">
	
	What is Vorto
</a>



  
</li>



<li>
  
    



<a  title="Getting started" href="https://www.eclipse.org/vorto/gettingstarted/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Tutorials" href="https://www.eclipse.org/vorto/tutorials/">
	
	Tutorials
</a>



  
</li>



<li>
  
    



<a  title="Downloads" href="https://www.eclipse.org/vorto/downloads/">
	
	Downloads
</a>



  
</li>



<li>
  
    



<a  title="Community" href="https://www.eclipse.org/vorto/community/">
	
	Community
</a>



  
</li>



<li>
  
    



<a  title="Release Notes" href="https://www.eclipse.org/vorto/release-notes/">
	
	Release Notes
</a>



  
</li>



<li>
  
    



<a  title="Reference Documentation" href="https://www.eclipse.org/vorto/documentation/">
	
	Reference Documentation
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">Build Status</span>
        
        <ul>
          
          <li>
            <a href="https://ci.eclipse.org/vorto" title="Eclipse Build Status" target="_blank">Jenkins@Eclipse</a>
          </li>
          
          <li>
            <a href="https://travis-ci.org/eclipse/vorto" title="Travis Build Status" target="_blank">
              <img src="https://travis-ci.org/eclipse/vorto.svg?branch=development" />
            </a>
          </li>
          <li>
            <a href="https://maven-badges.herokuapp.com/maven-central/org.eclipse.vorto/org.eclipse.vorto.parent" title="Travis Build Status" target="_blank">
              <img src="https://maven-badges.herokuapp.com/maven-central/org.eclipse.vorto/org.eclipse.vorto.parent/badge.svg" />
            </a>
          </li>
        </ul>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Payload Mapping </h1>

			<p>The payload mapping feature in Eclipse Vorto can be used to transform arbitrary payload to standardized Vorto messages and vice versa.</p>

<p></p>

<h2 id="motivation">Motivation</h2>

<p>IoT Devices may not always send their data to the cloud in the structure and protocol that is required by the IoT platform that the devices are integrating with, e.g. AWS IoT, Azure IoT or Eclipse IoT. The Eclipse Vorto Mapping feature is a light-weight Java library that is able to process Vorto Mapping Specifications to transform arbitrary device payload (Binary, JSON, XML, etc) to standardized data structures complying to Vorto Function Blocks.</p>

<p>An example standardized target data structure could look like this:</p>

<pre><code>{
    &quot;temperature&quot;:{
        &quot;properties&quot;:{
            &quot;status&quot;:{
                &quot;sensor_value&quot;: 25,
                &quot;sensor_unit&quot; : &quot;Celcius&quot;
            }
        }
    }
}
</code></pre>

<p>However, the device might send the data in binary hex format, like that:</p>

<pre><code>{
    &quot;data&quot; : &quot;0x09CF&quot;
}
</code></pre>

<h2 id="vorto-payload-mapping-engine">Vorto Payload Mapping Engine</h2>

<p>The Vorto Payload Mapping Engine is a very easy and light-weight component to convert device payload in different formats to a normalized and standardized Vorto Function Block representation which can then be converted further to specific IoT platform data structures.</p>

<p><img src="https://www.eclipse.org/vorto/images/documentation/payloadmapping.png" alt="Vorto Mapping Engine Overview" /></p>

<p>It supports Eclipse Ditto as the target platform mapping out-of-the-box. A Data Mapping API is available to implement the integration with other IoT platforms.</p>

<p><a href="https://www.eclipse.org/vorto/tutorials/payloadmapping/">Get started</a> of using the Vorto Payload Mapping Engine in a concrete example.</p>

<h3 id="built-in-mapping-converter-functions">Built-in Mapping Converter functions</h3>

<p>If you need to do value conversions from the device payload to the function block property value, the Vorto Mapping Engine offers a set of available built-in converter functions to choose from.</p>

<p>Here is an example that converts a string value to a float:</p>

<pre><code>from Accelerometer.status.x_value to source with {xpath:&quot;number:toFloat(/stringproperty)&quot;}
</code></pre>

<p>Please refer to the complete <a href="https://github.com/eclipse/vorto/blob/0.10.0.M3/server/repo/repository-mapping/docs/built_in_converters.md">Converter Functions documentation</a> for more information.</p>

<h4 id="example">Example</h4>

<p>In the following example, a <a href="https://github.com/myDevicesIoT/cayenne-docs/blob/master/docs/LORA.md">Cayenne Low Power Payload (LPP)</a> is converted to a float value for the IPSO compliant Accelerometer sensor_value property:</p>

<pre><code>    namespace devices.lora.cayenne.mapping
    version 1.0.0
    displayname &quot;Accelerometer PayloadMapping&quot;
    description &quot;Payload Mapping for the accelerometer property of the OctopusLoRaFeatherWing&quot;
    category payloadmapping

    using com.ipso.smartobjects.Accelerometer;0.0.1

    functionblockmapping AccelerometerPayloadMapping {
        targetplatform lora_cayenne
        from Accelerometer to functions with {convertValue:&quot;function convertValue(value) { return value / 1000;}&quot;}
        from Accelerometer.status.x_value to source with {xpath:&quot;accelerometer:convertValue( endian:swapShort(conversion:byteArrayToShort(binaryString:parseHexBinary(/payloadHex),17,0,0,2)))&quot;}
    } 
</code></pre>

<h3 id="create-a-custom-javascript-converter-function">Create a custom Javascript Converter function</h3>

<p>The Vorto Mapping engine uses <a href="http://www.oracle.com/technetwork/articles/java/jf14-nashorn-2126515.html">Nashorn</a> as a Javascript engine to execute custom converter functions.</p>

<h4 id="security">Security</h4>

<p>For security reasons, the following restrictions apply when processing these converters:</p>

<ul>
<li>access to Java packages and classes is not possible</li>
<li>using exit, quit, is not possible</li>
<li>file access is not possible</li>
<li>using loops are not allowed</li>
<li>no JS libraries can be loaded</li>
</ul>

<h4 id="example-1">Example</h4>

<p>In the following example, a custom (Javascript) converter is defined in a Function Block mapping, that converts a click amount as a <strong>String</strong> to an <strong>Integer</strong> value:</p>

<pre><code>    namespace devices.aws.button.mapping
    version 1.0.0
    displayname &quot;buttonPayloadMapping&quot;
    description &quot;Payload Mapping for the button property of the AWS IoT Button&quot;
    category payloadmapping

    using com.ipso.smartobjects.Push_button;0.0.1

    functionblockmapping ButtonPayloadMapping {
        targetplatform aws_ipso

        // Definition of Converter functions which can be used from within the function block mapping
        from Push_button to functions with 
            {convertClickType: &quot;function convertClickType(clickType) { if (clickType === 'SINGLE') return 1; else if (clickType === 'DOUBLE') return 2; else return -1;}&quot;}

        // Usage of the converter function in the mapping rule expression
        from Push_button.status.digital_input_count to source with {xpath: &quot;button:convertClickType(/clickType)&quot;}
    }
</code></pre>

<h3 id="mapping-conditions">Mapping Conditions</h3>

<p>If you want to specify a condition, when mapping rules should be applied, you can do this easily with mapping conditions.</p>

<p>Here is an example of using conditions to map to either temperature or illuminance based on the device payload header:</p>

<p>Function Block Temperature Mapping</p>

<pre><code>...
from Temperature.status.sensorValue to source with {xpath:&quot;/value&quot;, condition:&quot;xpath:eval(&quot;/header/type&quot;, this) == 'T'&quot;}
</code></pre>

<p>Function Block Illuminance Mapping</p>

<pre><code>...
from Illuminance.status.sensorValue to source with {xpath:&quot;/value&quot;, condition:&quot;xpath:eval(&quot;/header/type&quot;, this) == 'I'&quot;}
</code></pre>

<h3 id="useful-links">Useful Links</h3>

<ul>
<li><a href="https://www.eclipse.org/vorto/tutorials/payloadmapping/">Mapping device payload to standardized Vorto Function Blocks</a></li>
</ul>

			<aside class="copyright" role="note">
  <div class="logo">
    <a href="https://www.eclipse.org" target="_blank">
      <img src="https://www.eclipse.org/vorto/images/eclipse_logo_colour.png" />
    </a>
  </div>
  <p class="notice">
    
    &copy; 2018 The Eclipse Vorto Project &ndash;
    
    Documentation built with
    <a href="https://www.gohugo.io" target="_blank">Hugo</a>
    using the
    <a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
  </p>
  <p class="quickLinks">
    <a href="http://www.eclipse.org/legal/privacy.php" target="_blank">
      &gt; Privacy Policy
    </a>
    <a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">
      &gt; Terms of Use
    </a>
    <a href="http://www.eclipse.org/legal/copyright.php" target="_blank">
      &gt; Copyright Agent
    </a>
    <a href="http://www.eclipse.org/legal" target="_blank">
      &gt; Legal
    </a>
    <a href="https://www.eclipse.org/legal/epl-2.0/" target="_blank">
      &gt; License
    </a>
  </p>
</aside>


			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://www.eclipse.org/vorto/release-notes/" title="Release Notes">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Release Notes
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://www.eclipse.org/vorto/documentation/metamodel_uml/" title="Vorto Meta Model">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Vorto Meta Model
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/www.eclipse.org\/vorto\/';
      var repo_id  = 'eclipse\/vorto';
    
    </script>

    <script src="https://www.eclipse.org/vorto/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

