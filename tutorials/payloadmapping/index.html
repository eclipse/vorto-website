<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Mapping device payload to standardized Vorto Function Blocks - Eclipse Vorto</title>
    <meta name="generator" content="Hugo 0.33" />

    
    <meta name="description" content="Describe. Share. Integrate.">
    
    <link rel="canonical" href="https://www.eclipse.org/vorto/tutorials/payloadmapping/">
    
    <meta name="author" content="The Eclipse Vorto Project">
    

    <meta property="og:url" content="https://www.eclipse.org/vorto/tutorials/payloadmapping/">
    <meta property="og:title" content="Eclipse Vorto">
    <meta property="og:image" content="https://www.eclipse.org/vorto/images/vorto.png">
    <meta name="apple-mobile-web-app-title" content="Eclipse Vorto">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://www.eclipse.org/vorto/images/vorto.ico">
    <link rel="icon" type="image/x-icon" href="https://www.eclipse.org/vorto/images/vorto.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://www.eclipse.org/vorto/fonts/icon.eot');
        src: url('https://www.eclipse.org/vorto/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://www.eclipse.org/vorto/fonts/icon.woff')
               format('woff'),
             url('https://www.eclipse.org/vorto/fonts/icon.ttf')
               format('truetype'),
             url('https://www.eclipse.org/vorto/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/application.css">
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/css/vorto.css">
    
    <link rel="stylesheet" href="//www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/vendor/cookieconsent/cookieconsent.min.css">
    
    <script src="https://www.eclipse.org/vorto/javascripts/modernizr.js"></script>
    <script src="//www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Mapping device payload to standardized Vorto Function Blocks
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/VortoIoT" title="@VortoIoT on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/eclipse/vorto" title="@eclipse/vorto on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://www.eclipse.org/vorto/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://www.eclipse.org/vorto/images/vorto.png">
        </div>
      
      <div class="name">
        <strong>Eclipse Vorto </strong>
        
          <br>
          eclipse/vorto
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="http://vorto.eclipse.org" title="Repository" data-action="download">
              <i class="icon icon-search"></i> Repository
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/eclipse/vorto" target="_blank" title="Vorto on GitHub" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="What is Vorto" href="https://www.eclipse.org/vorto/introduction">
	
	What is Vorto
</a>



  
</li>



<li>
  
    



<a  title="Getting started" href="https://www.eclipse.org/vorto/gettingstarted/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Tutorials" href="https://www.eclipse.org/vorto/tutorials/">
	
	Tutorials
</a>



  
</li>



<li>
  
    



<a  title="Downloads" href="https://www.eclipse.org/vorto/downloads/">
	
	Downloads
</a>



  
</li>



<li>
  
    



<a  title="Community" href="https://www.eclipse.org/vorto/community/">
	
	Community
</a>



  
</li>



<li>
  
    



<a  title="Release Notes" href="https://www.eclipse.org/vorto/release-notes/">
	
	Release Notes
</a>



  
</li>



<li>
  
    



<a  title="Reference Documentation" href="https://www.eclipse.org/vorto/documentation/">
	
	Reference Documentation
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">Build Status</span>
        
        <ul>
          
          <li>
            <a href="https://ci.eclipse.org/vorto" title="Eclipse Build Status" target="_blank">Jenkins@Eclipse</a>
          </li>
          
          <li>
            <a href="https://travis-ci.org/eclipse/vorto" title="Travis Build Status" target="_blank">
              <img src="https://travis-ci.org/eclipse/vorto.svg?branch=development" />
            </a>
          </li>
          <li>
            <a href="https://maven-badges.herokuapp.com/maven-central/org.eclipse.vorto/org.eclipse.vorto.parent" title="Travis Build Status" target="_blank">
              <img src="https://maven-badges.herokuapp.com/maven-central/org.eclipse.vorto/org.eclipse.vorto.parent/badge.svg" />
            </a>
          </li>
        </ul>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Mapping device payload to standardized Vorto Function Blocks </h1>

			<p>IoT Devices may not always send their data to the cloud in the structure and protocol that is required by the IoT platform that the devices are integrating with, e.g. AWS IoT, Azure IoT or Eclipse IoT. Eclipse Vorto provides the tools and libraries for you to achieve that.</p>

<p>In this tutorial you are going to learn, how you create a Vorto Mapping Specification that maps a AWS IoT Button JSON payload to standardized <a href="https://github.com/IPSO-Alliance/pub">IPSO</a> Vorto Function Blocks and execute the mapping specification with the Vorto Mapping Engine. You will integrate the AWS IoT Button payload with the Eclipse Ditto Digital Twin service but also learn how to extend the Vorto Mapping Engine to map to other IoT platforms.</p>

<p></p>

<h2 id="prerequisite">Prerequisite</h2>

<ul>
<li><a href="https://www.eclipse.org/vorto/documentation/mappingengine/">Payload Mapping Engine Documentation</a></li>
<li><a href="https://marketplace.eclipse.org/content/vorto-toolset">Eclipse IoT Vorto Toolset</a></li>
<li>Maven</li>
</ul>

<h3 id="1-create-aws-iot-button-information-model">1. Create AWS IoT Button Information Model</h3>

<p>Let&rsquo;s start by creating an information model for the AWS IoT Button using the Vorto IoT Toolset:</p>

<pre><code>namespace devices.aws.button
version 1.0.0
displayname &quot;AWSIoTButton&quot;
description &quot;Model description for the AWS IoT Button.&quot;
using com.ipso.smartobjects.Push_button ; 0.0.1
using com.ipso.smartobjects.Voltage ; 0.0.1

infomodel AWSIoTButton {

    functionblocks {
        button as Push_button
        batteryVoltage as Voltage
    }
}
</code></pre>

<p>As you can see, it is just as easy as referencing the existing <a href="http://vorto.eclipse.org/#/?s=com.ipso.smartobjects&amp;t=Functionblock">IPSO Vorto Function Blocks</a> from the Information Model.</p>

<p>Now, you can login to the Vorto Repository and <strong>Share</strong> the Information Model.</p>

<p>Click on <strong>Details</strong> to open the information model in the <a href="http://vorto.eclipse.org/#/details/devices.aws.button/AWSIoTButton/1.0.0">Vorto Repository</a>.</p>

<h3 id="2-define-the-payload-mapping">2. Define the Payload Mapping</h3>

<p>Now it&rsquo;s time to define the actual payload mapping specification that defines how the actual AWS IoT Button payload maps to the standardized Vorto Function Blocks.</p>

<p>Mapping Specifications are written as *.mapping files and use xpath-like expressions that are applied on the source device payload.</p>

<p>For example, the AWS IoT button sends the following JSON payload:</p>

<pre><code>{&quot;clickType&quot; : &quot;DOUBLE&quot;, &quot;batteryVoltage&quot;: &quot;2322mV&quot;}  
</code></pre>

<p>Let&rsquo;s take this example and reduce the complexity in the example by merely creating a mapping specification for the batteryVoltage payload:</p>

<ol>
<li><p>Create a mapping file <em>awsiotbutton-ipso-battery.mapping</em> and add the following mapping rules:</p>

<pre><code>namespace devices.aws.button
version 1.0.0
displayname &quot;PayloadMapping BatteryVoltage&quot;
description &quot;Payload Mapping for the AWS IoT Button BatteryVoltage&quot;

using com.ipso.smartobjects.Voltage;0.0.1

functionblockmapping PayloadVoltageMapping {
    targetplatform aws-ipso

    from Voltage.status.sensor_value to source with {xpath: &quot;number:toFloat(string:substring(batteryVoltage,0,string:length(batteryVoltage)-2))&quot;}
    from Voltage.status.sensor_units to source with {xpath: &quot;string:substring(batteryVoltage,string:length(batteryVoltage)-2)&quot;}
</code></pre>

<p>}</p></li>
</ol>

<p>You may have spotted, that we are using a set of different xpath functions to define the mapping rule. You can find more information about all available functions and how to use them in the <a href="https://github.com/eclipse/vorto/blob/0.10.0.M3/server/repo/repository-mapping/docs/built_in_converters.md">Function Reference Documentation</a></p>

<ol>
<li><p>Create another mapping file <em>awsiotbutton-ipso.mapping</em> that references this mapping file to correlate it to the AWS IoT Button:</p>

<pre><code>namespace devices.aws.button.mapping
version 1.0.0
displayname &quot;AWSIoTButtonPayloadMapping&quot;
description &quot;Payload Mapping for AWSIoTButton&quot;
category payloadmapping

using devices.aws.button.AWSIoTButton;1.0.0
using devices.aws.button.mapping.BatteryVoltagePayloadMapping;1.0.0

infomodelmapping AWSIoTButtonPayloadMapping {
    targetplatform aws-ipso
    from AWSIoTButton.functionblocks.batteryVoltage to reference BatteryVoltagePayloadMapping
}
</code></pre></li>

<li><p>Log in to the <a href="http://vorto.eclipse.org">Vorto Repository</a> and publish the mapping files by selecting <strong>Share</strong>.</p></li>

<li><p>Once successfully checked in, you can have a look at the models in the repository. For sake of completion, we have added the mapping specification for button functionality as well:</p>

<ul>
<li><a href="http://vorto.eclipse.org/#/details/devices.aws.button.mapping/ButtonPayloadMapping/1.0.0">Button Mapping Specification for AWS IoT Button</a></li>
<li><a href="http://vorto.eclipse.org/#/details/devices.aws.button.mapping/BatteryVoltagePayloadMapping/1.0.0">Voltage Mapping Specification for AWS IoT Button</a></li>
</ul></li>
</ol>

<h3 id="3-execute-the-payload-mapping">3. Execute the Payload Mapping</h3>

<p>Now, let&rsquo;s process the mapping specification with the Vorto Mapping Engine. The Mapping Engine performs a two-phase mapping:</p>

<p><strong>Phase 1 (Normalization):</strong> Maps the arbitrary device payload to standardized Vorto Function Block payload.</p>

<p><strong>Phase 2 (Target Platform Mapping):</strong> Maps the Vorto Function Block payload to the target IoT platform - specific data model.</p>

<p>The Vorto Mapping Engine supports Eclipse Ditto as the target platform mapping out-of-the-box. However, we will show you later, how can you easily plug in your own IoT platform data model mapper (see appendix).</p>

<ol>
<li><p>First, add the following Maven dependency to your Maven Project:</p>

<pre><code>&lt;dependency&gt;
   &lt;groupId&gt;org.eclipse.vorto&lt;/groupId&gt;
   &lt;artifactId&gt;repository-mapping&lt;/artifactId&gt;
   &lt;version&gt;0.10.0.M3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre></li>

<li><p>Code snippet that transforms a sample AWS IoT Button JSON to Eclipse Vorto/Eclipse Ditto compliant data:</p>

<pre><code>IMappingSpecification spec = MappingSpecificationBuilder.create()
.infomodelId(&quot;devices.aws.button.AWSIoTButton:1.0.0&quot;)
.targetPlatformKey(&quot;aws-ipso&quot;)
.build();

IDataMapper&lt;DittoData&gt; mapper = IDataMapper.newBuilder().withSpecification(spec).buildDittoMapper();

String sampleDevicePayload = &quot;{\&quot;clickType\&quot; : \&quot;DOUBLE\&quot;, \&quot;batteryVoltage\&quot;: \&quot;2322mV\&quot;}&quot;;

DittoData mappedResult = mapper.map(DataInput.newInstance().fromJson(sampleDevicePayload),
        MappingContext.empty());

System.out.println(mappedResult.toJson());
</code></pre></li>

<li><p>The console shows the following mapped result:</p>

<pre><code>{
    &quot;button&quot;:{
        &quot;properties&quot;:{
            &quot;configuration&quot;:{},
            &quot;status&quot;:{
                &quot;digital_input_count&quot;:2,
                &quot;digital_input_state&quot;:true
            }
        }
    },
    &quot;voltage&quot;:{
        &quot;properties&quot;:{
            &quot;configuration&quot;:{},
            &quot;status&quot;:{
                &quot;sensor_units&quot;:&quot;mV&quot;,
                &quot;sensor_value&quot;:2322.0
            }
        }
    }
}
</code></pre></li>
</ol>

<h3 id="4-test-the-integration">4. Test the integration</h3>

<p>We are now ready to send the mapped JSON payload and modify an <a href="https://ditto.eclipse.org/">Eclipse Ditto</a> managed thing:</p>

<pre><code> curl -X PUT --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{ \ 
            &quot;button&quot;:{ \
                &quot;properties&quot;:{ \ 
                    &quot;configuration&quot;:{}, \ 
                    &quot;status&quot;:{ \ 
                        &quot;digital_input_count&quot;:2, \ 
                        &quot;digital_input_state&quot;:true \ 
                    } \ 
                } \ 
            }, \ 
            &quot;voltage&quot;:{ \ 
                &quot;properties&quot;:{ \ 
                    &quot;configuration&quot;:{}, \ 
                    &quot;status&quot;:{ \ 
                        &quot;sensor_units&quot;:&quot;mV&quot;, \ 
                        &quot;sensor_value&quot;:2322.0 \ 
                    } \ 
                } \ 
            } \ 
        }' 'https://ditto.eclipse.org/api/1/things/org.eclipse.vorto%3aws-iot-button/features'
</code></pre>

<p><strong>Voila!</strong> Your digital twin of the AWS IoT Button is now stored as standardized data, described as Vorto Function Blocks.</p>

<h3 id="appendix-plug-in-other-iot-platform-data-mapper">Appendix: Plug-in other IoT Platform Data Mapper</h3>

<p>The Vorto Mapping Engine is IoT platform agnostic, thus allowing you to extend it in order to integrate devices in a standardized way with other IoT platforms, like AWS IoT Shadow or Azure IoT.</p>

<p>Let&rsquo;s take a look what you need to do in order to do that:</p>

<ol>
<li><p>Add the Mapping Engine to your Maven project, if you have not already done so:</p>

<pre><code>&lt;dependency&gt;
   &lt;groupId&gt;org.eclipse.vorto&lt;/groupId&gt;
   &lt;artifactId&gt;repository-mapping&lt;/artifactId&gt;
   &lt;version&gt;0.10.0.M3&lt;/version&gt;
&lt;/dependency&gt;
</code></pre></li>

<li><p>Extend the <em>org.eclipse.vorto.service.mapping.AbstractDataMapper</em> and override the <em>doMap()</em> method</p>

<pre><code>import java.util.HashMap;
import java.util.Map;

import org.eclipse.vorto.service.mapping.AbstractDataMapper;
import org.eclipse.vorto.service.mapping.MappingContext;
import org.eclipse.vorto.service.mapping.normalized.FunctionblockData;
import org.eclipse.vorto.service.mapping.normalized.InfomodelData;
import org.eclipse.vorto.service.mapping.spec.IMappingSpecification;

public class MyPlatformMapper extends AbstractDataMapper&lt;MyPlatformModel&gt; {

    public MyPlatformMapper(IMappingSpecification spec) {
        super(spec);
    }

    @Override
    protected MyPlatformModel doMap(InfomodelData normalized, MappingContext mappingContext){
        // add your code here that maps the already normalized Vorto model to the platform specific model
    }


}
</code></pre></li>

<li><p>Use the Mapper to convert arbitrary device data to the specific platform data model:</p>

<pre><code>IDataMapper&lt;MyPlatformModel&gt; mapper = new MyPlatformMapper(mappingSpecification);

String sampleDeviceData = &quot;{\&quot;clickType\&quot; : \&quot;DOUBLE\&quot;, \&quot;batteryVoltage\&quot;: \&quot;2322mV\&quot;}&quot;;

MyPlatformModel result = mapper.map(DataInput.newInstance().fromJson(sampleDeviceData), MappingContext.empty());
</code></pre></li>
</ol>

			<aside class="copyright" role="note">
  <div class="logo">
    <a href="https://www.eclipse.org" target="_blank">
      <img src="https://www.eclipse.org/vorto/images/eclipse_logo_colour.png" />
    </a>
  </div>
  <p class="notice">
    
    &copy; 2018 The Eclipse Vorto Project &ndash;
    
    Documentation built with
    <a href="https://www.gohugo.io" target="_blank">Hugo</a>
    using the
    <a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
  </p>
  <p class="quickLinks">
    <a href="http://www.eclipse.org/legal/privacy.php" target="_blank">
      &gt; Privacy Policy
    </a>
    <a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">
      &gt; Terms of Use
    </a>
    <a href="http://www.eclipse.org/legal/copyright.php" target="_blank">
      &gt; Copyright Agent
    </a>
    <a href="http://www.eclipse.org/legal" target="_blank">
      &gt; Legal
    </a>
    <a href="https://www.eclipse.org/legal/epl-2.0/" target="_blank">
      &gt; License
    </a>
  </p>
</aside>


			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://www.eclipse.org/vorto/tutorials/grovepi/" title="Connecting a GrovePi to Eclipse Hono">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Connecting a GrovePi to Eclipse Hono
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://www.eclipse.org/vorto/downloads/" title="Downloads">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Downloads
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/www.eclipse.org\/vorto\/';
      var repo_id  = 'eclipse\/vorto';
    
    </script>

    <script src="https://www.eclipse.org/vorto/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

