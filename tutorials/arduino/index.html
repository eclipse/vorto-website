<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Connecting an ESP8266 to Eclipse Hono - Eclipse Vorto</title>
    <meta name="generator" content="Hugo 0.37.1" />

    
    <meta name="description" content="Describe. Share. Integrate.">
    
    <link rel="canonical" href="https://www.eclipse.org/vorto/tutorials/arduino/">
    
    <meta name="author" content="The Eclipse Vorto Project">
    

    <meta property="og:url" content="https://www.eclipse.org/vorto/tutorials/arduino/">
    <meta property="og:title" content="Eclipse Vorto">
    <meta property="og:image" content="https://www.eclipse.org/vorto/images/vorto.png">
    <meta name="apple-mobile-web-app-title" content="Eclipse Vorto">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://www.eclipse.org/vorto/images/vorto.ico">
    <link rel="icon" type="image/x-icon" href="https://www.eclipse.org/vorto/images/vorto.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://www.eclipse.org/vorto/fonts/icon.eot');
        src: url('https://www.eclipse.org/vorto/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://www.eclipse.org/vorto/fonts/icon.woff')
               format('woff'),
             url('https://www.eclipse.org/vorto/fonts/icon.ttf')
               format('truetype'),
             url('https://www.eclipse.org/vorto/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/application.css">
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://www.eclipse.org/vorto/css/vorto.css">
    
    <link rel="stylesheet" href="//www.eclipse.org/eclipse.org-common/themes/solstice/public/stylesheets/vendor/cookieconsent/cookieconsent.min.css">
    
    <script src="https://www.eclipse.org/vorto/javascripts/modernizr.js"></script>
    <script src="//www.eclipse.org/eclipse.org-common/themes/solstice/public/javascript/vendor/cookieconsent/default.min.js"></script>

    

  </head>
  <body class="palette-primary-blue palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Connecting an ESP8266 to Eclipse Hono
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/VortoIoT" title="@VortoIoT on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/eclipse/vorto" title="@eclipse/vorto on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://www.eclipse.org/vorto/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://www.eclipse.org/vorto/images/vorto.png">
        </div>
      
      <div class="name">
        <strong>Eclipse Vorto </strong>
        
          <br>
          eclipse/vorto
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="http://vorto.eclipse.org" title="Repository" data-action="download">
              <i class="icon icon-search"></i> Repository
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/eclipse/vorto" target="_blank" title="Vorto on GitHub" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          





<li>
  
    



<a  title="What is Vorto" href="https://www.eclipse.org/vorto/introduction">
	
	What is Vorto
</a>



  
</li>




<li>
  
    



<a  title="Getting started" href="https://www.eclipse.org/vorto/gettingstarted/">
	
	Getting started
</a>



  
</li>




<li>
  
    

<a  title="Tutorials" href="https://www.eclipse.org/vorto/tutorials/">
	
	Tutorials
</a>


    
    <ul>
      
        <li class="anchor">
        
        

<a  title="Connecting an ESP8266 to Eclipse Hono" href="https://www.eclipse.org/vorto/tutorials/arduino/">
	
	Connecting an ESP8266 to Eclipse Hono
</a>


        </li>
      
        <li class="anchor">
        
        

<a  title="Connecting a GrovePi to Eclipse Hono" href="https://www.eclipse.org/vorto/tutorials/grovepi/">
	
	Connecting a GrovePi to Eclipse Hono
</a>


        </li>
      
        <li class="anchor">
        
        

<a  title="How to describe a TI SensorTag device with Vorto" href="https://www.eclipse.org/vorto/tutorials/tisensor/">
	
	How to describe a TI SensorTag device with Vorto
</a>


        </li>
      
    </ul>
    
  
</li>




<li>
  
    

<a  title="User Guide" href="https://www.eclipse.org/vorto/userguide/">
	
	User Guide
</a>


    
  
</li>




<li>
  
    



<a  title="Developer Guide" href="https://www.eclipse.org/vorto/developerguide">
	
	Developer Guide
</a>



  
</li>




<li>
  
    



<a  title="Community" href="https://www.eclipse.org/vorto/community/">
	
	Community
</a>



  
</li>




<li>
  
    



<a  title="Release Notes" href="https://www.eclipse.org/vorto/release-notes/">
	
	Release Notes
</a>



  
</li>




<li>
  
    

<a  title="Reference Documentation" href="https://www.eclipse.org/vorto/appendix/">
	
	Reference Documentation
</a>


    
  
</li>


        </ul>
        

        
        <hr>
        <span class="section">Build Status</span>
        
        <ul>
          
          <li>
            <a href="https://ci.eclipse.org/vorto" title="Eclipse Build Status" target="_blank">Jenkins@Eclipse</a>
          </li>
          
          <li>
            <a href="https://travis-ci.org/eclipse/vorto" title="Travis Build Status" target="_blank">
              <img src="https://travis-ci.org/eclipse/vorto.svg?branch=development" />
            </a>
          </li>
          <li>
            <a href="https://maven-badges.herokuapp.com/maven-central/org.eclipse.vorto/parent" title="Travis Build Status" target="_blank">
              <img src="https://maven-badges.herokuapp.com/maven-central/org.eclipse.vorto/parent/badge.svg" />
            </a>
          </li>
        </ul>
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Connecting an ESP8266 to Eclipse Hono </h1>

			<p>This tutorial explains how to generate an Arduino sketch for a given Information Model and send the device data to Eclipse Hono via MQTT.</p>

<p></p>

<h3 id="prerequisites">Prerequisites</h3>

<ul>
<li><a href="https://www.arduino.cc/en/Main/Software">Arduino IDE</a>

<ul>
<li>ESP8266 Package</li>
<li><a href="https://pubsubclient.knolleary.net/">PubSubClient</a></li>
</ul></li>
<li>OpenSSL</li>
<li>Curl</li>
</ul>

<h3 id="1-setup-your-development-environment-on-your-development-machine">1. Setup your development environment (on your development machine).</h3>

<ul>
<li><p>Download and install the <a href="https://www.arduino.cc/en/Main/Software">Arduino IDE</a>.</p>

<ul>
<li><p>Install the ESP8266 Board Package.</p>

<ol>
<li><p>Select <strong>File -&gt; Preferences -&gt; Additional Board Manager URLs</strong> and add <code>http://arduino.esp8266.com/stable/package_esp8266com_index.json</code>.</p></li>

<li><p>Select <strong>Tools -&gt; Board -&gt; Boards Manager…</strong>, look for the esp8266 package and install the latest version.</p></li>

<li><p>Select <strong>Tools -&gt; Board</strong>.</p>

<p>You should now find all the supported ESP8266 boards listed, chose the one you are working with.</p></li>

<li><p>Plug-in the NodeMCU board and check in the Device Manager, whether you have the necessary USB serial driver installed. In case it is missing and Windows Update can’t find the driver, get the latest version of the driver from the <a href="https://github.com/nodemcu/nodemcu-devkit/blob/master/Drivers/">NodeMCU github repository</a>.</p></li>
</ol></li>

<li><p>Select <strong>Sketch -&gt; Include Library -&gt; Manage Libraries</strong>, look for the PubSubClient and install the latest version.</p>

<blockquote>
<p>Note: You can use the search field to search for the PubSubClient.</p>
</blockquote></li>
</ul>

<p>The PubSubClient will get installed in the Arduino/libraries directory, i.e. in <code>{HOME}/Arduino/libraries</code>. As you might need to adjust the buffer size for the MQTT payload, it is a good thing to verify the location of the library at this point.</p></li>
</ul>

<h3 id="2-generating-an-arduino-sketch-using-the-arduino-generator-arduino-project">2. Generating an arduino sketch using the Arduino Generator (Arduino project).</h3>

<ul>
<li>Open the <a href="http://vorto.eclipse.org/#/details/org.eclipse.vorto.tutorial/DistanceSensor/1.0.0">Distance Sensor</a> in the Vorto Repository</li>
<li>Click <strong>Eclipse Hono Generator</strong> and select <strong>Arduino</strong> as device platform. Confirm with <strong>Generate</strong>.</li>
<li>Download the ZIP file and extract the source code.</li>
<li>Open the INO file in your Arduino IDE.</li>
</ul>

<h3 id="3-registering-to-eclipse-hono">3. Registering to Eclipse Hono</h3>

<p>Eclipse Hono provides a sandbox environment, which we can use in this tutorial to integrate the GrovePi with. So before we can send any data, we must register the device in Eclipse Hono. We use <code>vortodemo</code> as a <strong>Hono tenant</strong> and <code>1234</code> as a <strong>device ID</strong>:</p>

<p><strong>Registering our Device</strong></p>

<pre><code class="language-sh">curl -X POST http://hono.eclipse.org:28080/registration/vortodemo
-i -H 'Content-Type: application/json'
-d '{&quot;device-id&quot;: &quot;1234&quot;}'
</code></pre>

<p><strong>Adding device credentials</strong></p>

<pre><code class="language-sh">PWD_HASH=$(echo -n &quot;S3cr3t&quot; | openssl dgst -binary -sha512 | base64 | tr -d '\n') 
curl -X POST http://hono.eclipse.org:28080/credentials/vortodemo
-i -H 'Content-Type: application/json'
-d 'JSON payload' 
</code></pre>

<p>Example JSON payload:</p>

<pre><code class="language-sh">{
  &quot;device-id&quot;: &quot;1234&quot;,
  &quot;auth-id&quot;: &quot;1234&quot;,
  &quot;type&quot;: &quot;hashed-password&quot;,
  &quot;secrets&quot;: [
    {
      &quot;hash-function&quot;: &quot;sha-512&quot;,
      &quot;pwd-hash&quot;: &quot;'$PWD_HASH'&quot;
    }
  ]
}
</code></pre>

<h3 id="4-adjust-the-arduino-project-according-to-your-needs">4. Adjust the Arduino Project according to your needs.</h3>

<p>The following important changes have to be made:</p>

<pre><code class="language-sh">/* Your tenant in Eclipse Hono / Bosch IoT Hub */
#define hono_tenant &quot;vortodemo&quot;

/* Device Configuration */
String hono_deviceId = &quot;1234&quot;;
String ditto_namespace = &quot;org.eclipse.vorto&quot;;

/* MQTT broker endpoint */
const char* hono_endpoint = &quot;ssl://hono.eclipse.org:8883&quot;;
const char* hono_password = &quot;S3cr3t&quot;;
String hono_authId;

#if (USE_SECURE_CONNECTION == 1)
    /* SHA-1 fingerprint of the server certificate of the MQTT broker, UPPERCASE and spacing */
    const char* mqttServerFingerprint = &quot;E6 A3 B4 5B 06 2D 50 9B 33 82 28 2D 19 6E FE 97 D5 95 6C CB&quot;;
#endif

/* WiFi Configuration */
const char* ssid = &quot;&lt;ENTER YOUR WIFI SSID&gt;&quot;;
const char* password = &quot;&lt;ENTER YOUR WIFI PASSWORD&gt;&quot;; 
</code></pre>

<ul>
<li><p>For a secure connection, you need a fingerprint of the server certificate. This finger print is an SHA-1 hash of the certificate of the MQTT broker.</p></li>

<li><p>If you want to create the fingerprint yourself <a href="https://letsencrypt.org/certs/lets-encrypt-x3-cross-signed.pem.txt">get the certificate</a> and copy and paste the content in a .crt file. The fingerprint for the certificate can be extracted by invoking:</p></li>
</ul>

<pre><code class="language-sh">openssl x509 -noout -fingerprint -sha1 -inform pem -in [certificate-file.crt]
</code></pre>

<ul>
<li><p>Connect your ESP8266 to your computer and select the virtual COM port to which your device is connected in the Arduino IDE under <strong>Tools -&gt; Port</strong> and upload the sketch.</p></li>

<li><p>Follow <a href="https://www.eclipse.org/hono/dev-guide/java_client_consumer/">Consuming Messages from Java for Hono</a> to receive the device data from Eclipse Hono.</p></li>
</ul>

<h2 id="what-s-next">What&rsquo;s next?</h2>

<ul>
<li><a href="https://www.eclipse.org/vorto/tutorials/grovepi/">Connect a GrovePi to Eclipse Hono</a></li>
</ul>

			<aside class="copyright" role="note">
  <div class="logo">
    <a href="https://www.eclipse.org" target="_blank">
      <img src="https://www.eclipse.org/vorto/images/eclipse_logo_colour.png" />
    </a>
  </div>
  <p class="notice">
    
    &copy; 2018 The Eclipse Vorto Project &ndash;
    
    Documentation built with
    <a href="https://www.gohugo.io" target="_blank">Hugo</a>
    using the
    <a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
  </p>
  <p class="quickLinks">
    <a href="http://www.eclipse.org/legal/privacy.php" target="_blank">
      &gt; Privacy Policy
    </a>
    <a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">
      &gt; Terms of Use
    </a>
    <a href="http://www.eclipse.org/legal/copyright.php" target="_blank">
      &gt; Copyright Agent
    </a>
    <a href="http://www.eclipse.org/legal" target="_blank">
      &gt; Legal
    </a>
    <a href="https://www.eclipse.org/legal/epl-2.0/" target="_blank">
      &gt; License
    </a>
  </p>
</aside>


			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://www.eclipse.org/vorto/gettingstarted/" title="Getting Started">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Getting Started
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://www.eclipse.org/vorto/tutorials/grovepi/" title="Connecting a GrovePi to Eclipse Hono">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Connecting a GrovePi to Eclipse Hono
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/www.eclipse.org\/vorto\/';
      var repo_id  = 'eclipse\/vorto';
    
    </script>

    <script src="https://www.eclipse.org/vorto/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

